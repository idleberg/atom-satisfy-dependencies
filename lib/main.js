module.exports=function(e){var n={};function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(o,r,function(n){return e[n]}.bind(null,r));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=4)}([function(e,n){e.exports=require("path")},function(e,n){e.exports=require("os")},function(e,n){e.exports=require("child_process")},function(e){e.exports=JSON.parse('{"name":"satisfy-dependencies","description":"Satisfies Atom package dependencies and, optionally, Node dependencies of installed packages","version":"0.4.2","license":"MIT","scripts":{"build":"webpack --mode production","dev":"webpack --mode none --watch","lint":"gulp lint","test":"npm run lint"},"author":{"name":"Jan T. Sott","url":"http://github.com/idleberg"},"keywords":["developer","package-dependencies","dependencies"],"repository":{"type":"git","url":"https://github.com/idleberg/atom-satisfy-dependencies.git"},"main":"./lib/main","engines":{"atom":">=1.0.0 <2.0.0"},"activationCommands":{"atom-workspace":["satisfy-dependencies:all","satisfy-dependencies:atom-packages","satisfy-dependencies:node-packages"]},"dependencies":{"atom-package-deps":"^7.0.2","pnpm":"^5.10.4","yarn":"^1.19.1"},"devDependencies":{"coffee-loader":"^1.0.1","coffeelint-stylish":"^0.1.2","coffeescript":"^2.4.1","gulp":"^4.0.2","gulp-coffeelint":"^0.6.0","gulp-debug":"^4.0.0","gulp-jsonlint":"^1.3.1","husky":"^4.3.0","webpack":"^4.41.2","webpack-cli":"^3.3.10"},"husky":{"hooks":{"pre-commit":"npm run test"}}}')},function(e,n,t){e.exports={config:{packageManager:{title:"Package Manager",description:"Pick your preferred package manager for installing",type:"string",default:"apm",enum:["apm","pnpm","yarn"],order:0},showPrompt:{title:"Show Prompt",description:"Displays an prompt before installing Atom packages",type:"boolean",default:!1,order:1},verboseMode:{title:"Verbose Mode",description:"Output progress to the console",type:"boolean",default:!1,order:2},manageDependencies:{title:"Manage Dependencies",description:"When enabled, third-party dependencies will be installed automatically",type:"boolean",default:!0,order:3}},subscriptions:null,activate:function(){var e,n;return({CompositeDisposable:e}=t(5)),({satisfy:n}=t(6)),this.subscriptions=new e,this.subscriptions.add(atom.commands.add("atom-workspace",{"satisfy-dependencies:all":function(){return n(!0,!0)}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"satisfy-dependencies:atom-packages":function(){return n(!0,!1)}})),this.subscriptions.add(atom.commands.add("atom-workspace",{"satisfy-dependencies:node-packages":function(){return n(!1,!0)}}))},deactivate:function(){var e;return null!=(e=this.subscriptions)&&e.dispose(),this.subscriptions=null}}},function(e,n){e.exports=require("atom")},function(e,n,t){var o;e.exports=o={satisfy:function(e,n){var r,a,i,s,c,l,d,u;for(({join:a}=t(0)),u=[],r=0,i=(c=atom.packages.getLoadedPackages()).length;r<i;r++)if(s=c[r],!atom.packages.isBundledPackage(s.name)){l=a(s.path,"package.json");try{d=t(7)(l)}catch(e){console.log(`[${s.name}] Missing package manifest, skipping...`);continue}!0===e&&!0===d.hasOwnProperty("package-deps")&&o.installAtom(s.name),!0===n?u.push(o.installNode(s)):u.push(void 0)}return u},installAtom:function(e){var n,o;return({install:n}=t(8)),o=t(3),!0===atom.config.get(o.name+".verboseMode")&&console.time(e+": Completed"),n(e,atom.config.get(o.name+".showPrompt")).then((function(){if(!0===atom.config.get(o.name+".verboseMode")&&console.log(e+": Installing Atom package dependencies"),!0===atom.config.get(o.name+".verboseMode"))return console.timeEnd(e+": Completed")})).catch((function(e){if(e)return console.error(e)}))},installNode:function(e){var n,o,r,a,i,s,c;return({platform:s}=t(1)),({getPackageManager:a,spawnAsPromised:c}=t(10)),o=a(),"win32"===s()?(r=["/c",o.bin,"install","--production"],o.bin="cmd.exe"):r=["install","--production"],n=r.concat(o.args),i={cwd:e.path},c(o.bin,n,i).then((function(n){return console.info(`Spawning ${o.name} in '${e.name}' directory`),console.log(n)})).catch((function(e){if(e)return console.error(e)}))}}},function(e,n){function t(e){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id=7},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=t(1),r=t(2),a=t(9),i=t(0);function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=s(o),l=s(a),d=s(i);const u=/\s+at.*(?:\(|\s)(.*)\)?/,p=/^(?:(?:(?:node|(?:internal\/[\w/]*|.*node_modules\/(?:babel-polyfill|pirates)\/.*)?\w+)\.js:\d+:\d+)|native)/,f=void 0===c.default.homedir?"":c.default.homedir();class m extends Error{constructor(e){if(!Array.isArray(e))throw new TypeError("Expected input to be an Array, got "+typeof e);let n=(e=[...e].map(e=>e instanceof Error?e:null!==e&&"object"==typeof e?Object.assign(new Error(e.message),e):new Error(e))).map(e=>{return"string"==typeof e.stack?(e=>e.replace(/\s+at .*aggregate-error\/index.js:\d+:\d+\)?/g,""))((n=e.stack,t=Object.assign({pretty:!1},t),n.replace(/\\/g,"/").split("\n").filter(e=>{const n=e.match(u);if(null===n||!n[1])return!0;const t=n[1];return!t.includes(".app/Contents/Resources/electron.asar")&&!t.includes(".app/Contents/Resources/default_app.asar")&&!p.test(t)}).filter(e=>""!==e.trim()).map(e=>t.pretty?e.replace(u,(e,n)=>e.replace(n,n.replace(f,"~"))):e).join("\n"))):String(e);var n,t}).join("\n");n="\n"+((e,n=1,t)=>{if(t={indent:" ",includeEmptyLines:!1,...t},"string"!=typeof e)throw new TypeError(`Expected \`input\` to be a \`string\`, got \`${typeof e}\``);if("number"!=typeof n)throw new TypeError(`Expected \`count\` to be a \`number\`, got \`${typeof n}\``);if("string"!=typeof t.indent)throw new TypeError(`Expected \`options.indent\` to be a \`string\`, got \`${typeof t.indent}\``);if(0===n)return e;const o=t.includeEmptyLines?/^/gm:/^(?!\s*$)/gm;return e.replace(o,t.indent.repeat(n))})(n,4),super(n),this.name="AggregateError",Object.defineProperty(this,"_errors",{value:e})}*[Symbol.iterator](){for(const e of this._errors)yield e}}var g=m;const y=(e,n,t)=>new Promise((o,r)=>{if(t=Object.assign({concurrency:1/0},t),"function"!=typeof n)throw new TypeError("Mapper function is required");const{concurrency:a}=t;if(!("number"==typeof a&&a>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${a}\` (${typeof a})`);const i=[],s=e[Symbol.iterator]();let c=!1,l=!1,d=0,u=0;const p=()=>{if(c)return;const e=s.next(),t=u;if(u++,e.done)return l=!0,void(0===d&&o(i));d++,Promise.resolve(e.value).then(e=>n(e,t)).then(e=>{i[t]=e,d--,p()},e=>{c=!0,r(e)})};for(let e=0;e<a&&(p(),!l);e++);});var h=y,w=y;h.default=w;const v=async(e,n,t)=>(await h(e,(e,t)=>Promise.all([n(e,t),e]),t)).filter(e=>Boolean(e[0])).map(e=>e[1]);var b=v,k=v;b.default=k;const P="undefined"!=typeof atom,E="undefined"!=typeof atom&&(atom.inDevMode()||atom.inSpecMode());
/*!
 * escape-html
 * Copyright(c) 2012-2013 TJ Holowaychuk
 * Copyright(c) 2015 Andreas Lubbe
 * Copyright(c) 2015 Tiancheng "Timothy" Gu
 * MIT Licensed
 */
var j=/["'&<>]/,x=function(e){var n,t=""+e,o=j.exec(t);if(!o)return t;var r="",a=0,i=0;for(a=o.index;a<t.length;a++){switch(t.charCodeAt(a)){case 34:n="&quot;";break;case 38:n="&amp;";break;case 39:n="&#39;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}i!==a&&(r+=t.substring(i,a)),i=a+1,r+=n}return i!==a?r+t.substring(i,a):r};function A(e,n,t){let o;const a=async function(e,n,t){const o=r.spawn(e,n,t),a=new Promise((e,n)=>{const r={stdout:o.stdout?[]:null,stderr:o.stderr?[]:null};o.on("error",n),o.stdout&&o.stdout.on("data",(function(e){r.stdout.push(e),t.handleStdout&&t.handleStdout(e)})),o.stderr&&o.stderr.on("data",(function(e){r.stderr.push(e),t.handleStderr&&t.handleStderr(e)})),o.on("close",n=>{let o=null;null!=r.stdout&&(o=null===t.encoding||"buffer"===t.encoding?Buffer.concat(r.stdout):r.stdout.join(""));let a=null;null!=r.stderr&&(a=null===t.encoding||"buffer"===t.encoding?Buffer.concat(r.stderr):r.stderr.join("")),e({exitCode:n,stdout:o,stderr:a})})});return t.handleChildProcess(o),a}(e,n,{...t,handleChildProcess(e){o=e}});return a.kill=function(e){return o.kill(e)},a}async function M(e){if(P){const n=await async function(e){var n;const t=atom.packages.getLoadedPackage(e.name);return null==t?null:null!==(n=t.metadata.version)&&void 0!==n?n:null}(e);if(n)return n}return async function(e){var n,t;const{directory:o}=e;if(null==o)return null;let r=null;try{r=JSON.parse(await l.default.promises.readFile(d.default.join(o,"package.json"),"utf8"))}catch(e){return null}return null!==(n=null===(t=r)||void 0===t?void 0:t.version)&&void 0!==n?n:null}(e)}const S=P?async function(e){return atom.packages.resolvePackagePath(e)}:async function(e){var n;const t=d.default.join(null!==(n=process.env.ATOM_HOME)&&void 0!==n?n:d.default.join(c.default.homedir(),".atom"),"packages",e);try{return await l.default.promises.access(t,l.default.constants.R_OK),t}catch(e){return null}};function C(e,n){if(!e)throw new Error(null!=n?n:"Invariant violation")}async function D(e){const n=await(P?async function(e){const n=atom.packages.getLoadedPackage(e),t=n&&n.metadata["package-deps"];return Array.isArray(t)?t:[]}(e):async function(e){let n=null;try{n=await l.default.promises.stat(e)}catch(e){}if(null==n||!n.isDirectory())throw new Error("[Package-Deps] Expected packageName to be a readable directory in Node.js invocation");let t=null;try{const n=await l.default.promises.readFile(d.default.join(e,"package.json"),"utf8");t=JSON.parse(n)}catch(e){}const o=null==t||"object"!=typeof t?[]:t["package-deps"];return Array.isArray(o)?o:[]}(e));return E&&(C(Array.isArray(n),`Dependencies for ${e} are not a valid array`),n.forEach((n,t)=>{if(Array.isArray(n))n.forEach((n,o)=>{const r=`Dependency#${t}#${o} for ${e} is invalid`;C("string"==typeof n.name&&n.name.length>0,r),C(null==n.minimumVersion||"string"==typeof n.minimumVersion&&n.minimumVersion.length>0,r)}),C(n.length>0,`Dependency#${t} for ${e} has no group items`);else{const o=`Dependency#${t} for ${e} is invalid`;C("string"==typeof n.name&&n.name.length>0,o),C(null==n.minimumVersion||"string"==typeof n.minimumVersion&&n.minimumVersion.length>0,o)}})),n}async function N(e){if(null==e.directory)return!0;if(null==e.minimumVersion)return!1;const n=await M(e);return null==n||1===function(e,n){for(var t=e.split("."),o=n.split("."),r=0;r<3;r++){var a=Number(t[r]),i=Number(o[r]);if(a>i)return 1;if(i>a)return-1;if(!isNaN(a)&&isNaN(i))return 1;if(isNaN(a)&&!isNaN(i))return-1}return 0}(e.minimumVersion,n)}const $=new Set(["âœ“","done"]),O=/(?:Installing|Moving) (.*?) to .* (.*)/;let T=!0;const _=P?function({packageName:e,dependencies:n}){const t=[],o=atom.notifications.addInfo(`Installing ${e} dependencies`,{detail:"Installing "+n.map(e=>e.name).join(", "),dismissable:!0}),r=document.createElement("progress");r.max=n.length,r.style.width="100%";try{var a;const e=atom.views.getView(o),n=null!==(a=null==e?void 0:e.element)&&void 0!==a?a:null;if(null==n)throw new Error("Unable to get notification element from view");const t=n.querySelector(".detail-content");if(null==t)throw new Error("Content detail container not found inside the notification");t.appendChild(r)}catch(e){console.error("[Package-Deps] Error during showing installation progress to user",e)}return{handleFailure({dependency:e,error:n}){var o;t.push(e.name),r.value+=1,console.error(`[Package-Deps] Unable to install ${e.name}, Error:`,null!==(o=null==n?void 0:n.stack)&&void 0!==o?o:n)},handleDependencyInstalled(e){r.value+=1},handleComplete(){o.dismiss(),t.length>0?atom.notifications.addWarning(`Failed to install ${e} dependencies`,{detail:"These packages were not installed, check your console\nfor more info.\n"+t.join("\n"),dismissable:!0}):atom.notifications.addSuccess(`Installed ${e} dependencies`,{detail:"Installed "+n.map(e=>e.name).join(", ")}),Promise.all(n.map(e=>t.includes(e.name)?null:atom.packages.activatePackage(e.name))).catch(n=>{console.error("[Package-Deps] Error activating installed packages for "+e,n)})}}}:function({dependencies:e}){let n=!1;return console.log("Installing dependencies:\n"+e.map(e=>"  - "+e.name).join("\n")),{handleFailure({dependency:e,error:t}){var o;n=!0,console.error(`Unable to install ${e.name}, Error:`,null!==(o=null==t?void 0:t.stack)&&void 0!==o?o:t)},handleDependencyInstalled(e){console.log("Successfully installed",e.name)},handleComplete(){console.log("Installation complete"),n&&(process.exitCode=1)}}},I=P?function({packageName:e,dependencies:n}){return new Promise(t=>{const o=n.filter(e=>!Array.isArray(e)),r=n.filter(e=>Array.isArray(e)),a=0===r.length,i=a?o.map(e=>e.name).join(", "):"Something went wrong. Check your developer console",s=r.map(e=>e[0]),c=atom.notifications.addInfo(e+" needs to install dependencies",{dismissable:!0,icon:"cloud-download",detail:i,description:`Install dependenc${1===n.length?"y":"ies"}?`,buttons:[{text:"Yes",onDidClick:()=>{t(a?[]:o.concat(s)),c.dismiss()}},{text:"No Thanks",onDidClick:()=>{c.dismiss()}},{text:"Never",onDidClick:()=>{!function(e){var n;if(!P)return;const t=new Set(null!==(n=atom.config.get("atom-package-deps.ignored"))&&void 0!==n?n:[]);t.add(e),atom.config.set("atom-package-deps.ignored",Array.from(t))}(e),T&&(T=!1,atom.notifications.addInfo("How to reset package-deps memory",{dismissable:!0,description:"To modify the list of ignored files invoke 'Application: Open Your Config' and change the 'atom-package-deps' section"})),c.dismiss()}}]});if(c.onDidDismiss(()=>t([])),!a)try{var l;const e=atom.views.getView(c),n=null!==(l=null==e?void 0:e.element)&&void 0!==l?l:null;if(null==n)throw new Error("Unable to get notification element from view");const t=n.querySelector(".detail-content");if(null==t)throw new Error("Content detail container not found inside the notification");if(t.innerHTML="",o.length>0){const e=document.createElement("div");e.innerHTML=`Packages without choices: <br /><ul><li>${o.map(e=>x(e.name)).join("</li><li>")}</li></ul>`,t.appendChild(e)}const a=document.createElement("div");a.innerHTML="Packages with choices:",t.appendChild(a);const i=document.createElement("ul");r.forEach((e,n)=>{const t=document.createElement("li"),o=document.createElement("select");o.innerHTML=e.map(e=>`<option>${x(e.name)}</option>`).join("\n"),o.addEventListener("change",()=>{const t=e.find(e=>e.name===o.value);null!=t&&(s[n]=t)}),t.style.marginTop="5px",t.appendChild(o),i.appendChild(t)}),t.appendChild(i)}catch(e){console.error("[Package-Deps] Error during showing package choices to user",e)}})}:async function({dependencies:e}){return e.map(e=>Array.isArray(e)?e[0]:e)};n.install=async function(e){if(C("string"==typeof e&&e.length>0,"[Package-Deps] Package name is required"),n=e,P&&((null!==(t=atom.config.get("atom-package-deps.ignored"))&&void 0!==t?t:[]).includes(n)||atom.packages.isPackageDisabled("notifications")&&(console.warn("Enable notifications to install dependencies for "+n),1)))return;var n,t;const o=await D(e);if(0===o.length)return;const r=await Promise.all(o.map(async e=>Array.isArray(e)?Promise.all(e.map(async e=>({...e,directory:await S(e.name)}))):{...e,directory:await S(e.name)})),a=await b(r,(async function(e){return Array.isArray(e)?(await Promise.all(e.map(e=>N(e)))).every(Boolean):N(e)}));if(0===a.length)return;const i=await I({packageName:e,dependencies:a});if(0===i.length)return;const s=_({packageName:e,dependencies:i});await(async(e,n,{concurrency:t=1/0,stopOnError:o=!0}={})=>new Promise((r,a)=>{if("function"!=typeof n)throw new TypeError("Mapper function is required");if(!Number.isSafeInteger(t)&&t!==1/0||!(t>=1))throw new TypeError(`Expected \`concurrency\` to be an integer from 1 and up or \`Infinity\`, got \`${t}\` (${typeof t})`);const i=[],s=[],c=e[Symbol.iterator]();let l=!1,d=!1,u=0,p=0;const f=()=>{if(l)return;const e=c.next(),t=p;if(p++,e.done)return d=!0,void(0===u&&(o||0===s.length?r(i):a(new g(s))));u++,(async()=>{try{const o=await e.value;i[t]=await n(o,t),u--,f()}catch(e){o?(l=!0,a(e)):(s.push(e),u--,f())}})()};for(let e=0;e<t&&(f(),!d);e++);}))(i,(async function(e){try{await async function(e){const n=P?atom.packages.getApmPath():"apm",{stdout:t,stderr:o}=await A(n,["install",e.name,"--production","--color","false"]),r=O.exec(t.trim());if(null!=r&&$.has(r[2]))return;const a=new Error("Error installing dependency: "+e.name);throw a.stack=o.trim(),a}(e),s.handleDependencyInstalled(e)}catch(n){s.handleFailure({dependency:e,error:n})}}),{concurrency:2}),s.handleComplete()}},function(e,n){e.exports=require("fs")},function(e,n,t){(function(n){var o;e.exports=o={getPackageManager:function(){var e;switch(e=t(3),atom.config.get(e.name+".packageManager")){case"pnpm":return{name:"pnpm",bin:o.getPnpmPath(),args:["--no-color","--no-lock"]};case"yarn":return{name:"yarn",bin:o.getYarnPath(),args:["--pure-lockfile"]};default:return{name:"apm",bin:"apm",args:["--no-color","--quiet"]}}},getPnpmPath:function(){var e,o;return({join:e}=t(0)),({platform:o}=t(1)),"win32"===o()?e(n,"..","node_modules",".bin","pnpm.cmd"):e(n,"..","node_modules",".bin","pnpm")},getYarnPath:function(){var e,o;return({join:e}=t(0)),({platform:o}=t(1)),"win32"===o()?e(n,"..","node_modules",".bin","yarn.cmd"):e(n,"..","node_modules",".bin","yarn")},spawnAsPromised:function(){var e,n;return({spawn:n}=t(2)),e=Array.prototype.slice.call(arguments),new Promise((function(t,o){var r,a,i;i="",a="",(r=n.apply(null,e)).stdout.on("data",(function(e){i+=e})),r.stderr.on("data",(function(e){a+=e})),r.on("error",o).on("close",(function(e){0===e?t(i):o(a)}))}))}}}).call(this,"/")}]);
//# sourceMappingURL=main.js.map